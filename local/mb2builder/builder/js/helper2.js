/**
 *
 * @package    local_mb2builder
 * @copyright  2018 - 2020 Mariusz Boloz (https://mb2themes.com/)
 * @license    Commercial https://themeforest.net/licenses
 */
var current_selection,current_selection_offset,current_selection_range;function local_mb2builder_replace_text(e){var t=$("#mb2-pb-lang");if(""!==e){return e=(e=e.replace(/\[.+\]/g,t.data("shortcodereplaced"))).replace("GENERICO","GENERIC0")}}function local_mb2builder_helper_editor_init(e,t,a){document.queryCommandSupported("DefaultParagraphSeparator")&&document.execCommand("DefaultParagraphSeparator",!1,"p"),local_mb2builder_helper_editor_update_from_textarea(e),local_mb2builder_action_editor_html(t,a,!1,!0)}function local_mb2builder_action_editor_html(e,t,a,i){var r=e.closest(".mb2-pb-form-group").find(".mb2-pb-editor-document-active"),l=t;t.hasClass("mb2-pb-tabs_item")&&(t=t.closest(".mb2-pb-tabs")),a&&(r=e),e.attr("data-selector")&&(l=t.find(e.attr("data-selector"))),i?r.on("input",function(){a?(l.html(local_mb2builder_replace_text($(this).val())),t.attr("data-"+e.attr("data-attrname"),$(this).val())):(l.html(local_mb2builder_helper_editor_get_clean_html()),t.attr("data-"+e.attr("data-attrname"),local_mb2builder_helper_editor_get_clean_html()))}):l.html(local_mb2builder_helper_editor_get_clean_html())}function local_mb2builder_helper_editor_link_insert(e,t,a){local_mb2builder_helper_editor_document_focus();var i=current_selection_range;a.length?(a.attr("href",e),t.prop("checked")?a.attr("target","_blank"):a.removeAttr("target")):(link=document.createElement("a"),i.collapsed?link.appendChild(document.createTextNode(e)):link.appendChild(document.createTextNode(i.toString())),link.setAttribute("href",e),t.prop("checked")?link.setAttribute("target","_blank"):link.removeAttribute("target"),i.deleteContents(),i.insertNode(link))}function local_mb2builder_helper_editor_link_after_save(){$('input[name="mb2_pb_input_link_url"]').val(""),$('input[name="mb2_pb_editor_link_target"]').checked=!1,$(".mb2-pb-editor-document").find("a").removeClass("active")}function local_mb2builder_helper_editor_update_from_textarea(e){e||(e=local_mb2builder_helper_editor_get_empty_content());var t=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document");t.empty(),t.append(local_mb2builder_helper_editor_clean_html(e)),""===t.html()&&t.html(local_mb2builder_helper_editor_get_empty_content())}function local_mb2builder_helper_editor_update_from_textarea_before_save(){var e=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").closest(".form-group").find(".mb2-pb-editor-input");e.hasClass("editing")&&local_mb2builder_helper_editor_update_from_textarea(e.val())}function local_mb2builder_helper_editor_get_empty_content(){return"<p><br></p>"}function local_mb2builder_helper_editor_document_focus(){$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").focus()}function local_mb2builder_helper_editor_clean_html(e){return local_mb2builder_helper_editor_content_with_rules(e,[{regex:/<style[^>]*>[\s\S]*?<\/style>/gi,replace:""},{regex:/<!--(?![\s\S]*?-->)/gi,replace:""},{regex:/<\/?(?:title|meta|style|st\d|head|font|html|body|link)[^>]*?>/gi,replace:""}])}function local_mb2builder_helper_editor_content_with_rules(e,t){var a=0;for(a=0;a<t.length;a++)e=e.replace(t[a].regex,t[a].replace);return e}function local_mb2builder_helper_editor_get_clean_html(){var e=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").clone();e.find('[id^="yui"]').each(function(){$(this).removeAttr("id")}),e.find('*[class=""]').each(function(){$(this).removeAttr("class")});var t=e.html();return"<p></p>"===(t=local_mb2builder_replace_text(t))||"<p><br></p>"===t?"":t}function local_mb2builder_icon_action(e,t,a){var i=local_mb2builder_get_section(a),r=i;(t.attr("data-selector")&&(r=i.find(t.attr("data-selector"))),i.hasClass("mb2pb-button")&&r.closest(".btn-incon").removeClass("hidden"),i.attr("data-"+t.attr("data-attrname"),e),t.attr("data-globalparent"))?i.find(".mb2-pb-subelement").each(function(){$(this).attr("data-"+t.attr("data-attrname"))||$(this).find(r).attr("class",e)}):r.attr("class",e)}function local_mb2builder_icon_remove_action(e,t){var a=local_mb2builder_get_section(t),i=a;(e.attr("data-selector")&&(i=a.find(e.attr("data-selector"))),a.hasClass("mb2pb-button")&&i.closest(".btn-incon").addClass("hidden"),e.attr("data-default")&&!e.attr("data-globalparent")&&a.attr("data-"+e.attr("data-attrname"),e.attr("data-default")),e.attr("data-default")&&e.attr("data-globalparent"))?(a.find(".mb2-pb-subelement").each(function(){$(this).attr("data-"+e.attr("data-attrname"))||$(this).find(i).attr("class",e.attr("data-default"))}),a.attr("data-"+e.attr("data-attrname"),e.attr("data-default"))):e.attr("data-globalchild")?(a.attr("data-"+e.attr("data-attrname"),""),i.attr("class",a.closest(".mb2-pb-element").attr("data-"+e.attr("data-attrname")))):e.attr("data-default")?i.attr("class",e.attr("data-default")):(a.attr("data-"+e.attr("data-attrname"),""),i.attr("class","hidden"))}function local_mb2builder_get_section(e){var t=$(".mb2-pb-section-active");return"settings-row"===e?t=$(".mb2-pb-row-active"):"settings-column"===e?t=$(".mb2-pb-column-active"):"settings-element"===e?t=$(".mb2-pb-element-active"):"settings-subelement"===e&&(t=$(".mb2-pb-subelement-active")),t}function local_mb2builder_image_action(e,t,a){var i=local_mb2builder_get_section(a),r=i;t.attr("data-parent")&&(r=i.closest(".mb2-pb-element").find('.mb2-pb-carousel-item[data-pbid="'+i.attr("data-pbid")+'"]'));var l=r;if(t.attr("data-selector")&&(l=r.find(t.attr("data-selector"))),"background-image"===t.attr("data-style_properity"))l.css("background-image","url('"+e+"')");else{if("videofile"===t.attr("data-attrname")){var n='<video controls="true"><source src="'+e+'"></video>';l.parent().find(".videolocal-placeholder").hide(),l.html(n)}else l.attr("src",e);t.attr("data-parent")&&(i.find(t.attr("data-selector")).attr("src",e),i.css("background-image","url('"+e+"')"))}}function local_mb2builder_image_remove_action(e,t){var a=local_mb2builder_get_section(t),i=a;e.attr("data-selector")&&(i=a.find(e.attr("data-selector"))),"background-image"===e.attr("data-style_properity")?i.css(e.attr("data-style_properity"),"none"):"videofile"===e.attr("data-attrname")?(i.html(""),i.parent().find(".videolocal-placeholder").show()):i.attr("src","")}function local_mb2builder_check_image(e){if(e)return!(!e.toLowerCase().match(/\.(jpg|jpeg|png|gif)/g)&&!e.includes("sample-data"))}function local_mb2builder_get_media_name(e){var t=$("#mb2-pb-modal-images").data("images_baseurl");return e=e.replace(t,"")}function local_mb2builder_strip_html(e){return e.replace(/<\/?[^>]+(>|$)/g,"")}jQuery(document).ready(function(e){e(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-htmlmode",function(t){var a=e(this).closest(".form-group"),i=a.find(".mb2-pb-editor-input"),r=e(".mb2-pb-element-active");e(".mb2-pb-subelement-active").length&&(r=e(".mb2-pb-subelement-active")),i.hasClass("editing")?(local_mb2builder_helper_editor_update_from_textarea(i.val()),i.removeClass("editing"),a.removeClass("source"),local_mb2builder_action_editor_html(i,r,!1,!0)):(i.val(""),i.addClass("editing"),a.addClass("source"),textarea_value=local_mb2builder_helper_editor_get_clean_html(),i.val(textarea_value),local_mb2builder_action_editor_html(i,r,!0,!0))}),e(document).on("click",".mb2-pb-active-editor button",function(t){t.preventDefault(),local_mb2builder_helper_editor_document_focus();var a=e(this),i=a.data("action"),r=!1,l=null;a.data("show-default-ui")&&(r=a.data("show-default-ui")),a.data("value-args")&&(l=a.data("value-args")),document.execCommand(i,r,l)}),e(document).on("change",'.mb2-pb-active-editor select[data-action="formatBlock"]',function(t){e(this).val()&&document.execCommand("formatBlock",!1,"<"+e(this).val()+">")}),e(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-link-save",function(t){t.preventDefault();var a=e(this).closest(".mb2-pb-editor-helper-element"),i=a.find('input[name="mb2_pb_input_link_url"]').val(),r=a.find('input[name="mb2_pb_editor_link_target"]'),l=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("a.active");e(this).closest(".mb2-pb-editor-helper-element").slideUp(250),i&&(local_mb2builder_helper_editor_link_insert(i,r,l),local_mb2builder_helper_editor_link_after_save())}),e(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-image-remove",function(t){t.preventDefault(),local_mb2builder_helper_editor_document_focus();var a=e(this).closest(".mb2-pb-editor-helper-element"),i=a.find('input[name="mb2_pb_input_image_url"]').val();e(this).closest(".mb2-pb-editor-helper-element").slideUp(250),e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find('img[src="'+i+'"]').remove(),e(this).closest(".mb2-pb-editor-helper").find(".mb2-pb-preview-image").hide(),a.find("input").val(""),a.find("select").val("img-align-none");var r=e(".mb2-pb-element-active");0==r.length&&(r=e(".mb2-pb-subelement-active")),local_mb2builder_action_editor_html(e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-input"),r,!1,!1)}),e(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-image-save",function(t){t.preventDefault(),local_mb2builder_helper_editor_document_focus();var a=e(this).closest(".mb2-pb-editor-helper-element"),i=a.find('input[name="mb2_pb_input_image_url"]'),r=i.val();if(e(this).closest(".mb2-pb-editor-helper-element").slideUp(250),r){var l=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img.active");0==l.length&&document.execCommand("insertimage",!1,r);var n=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find('img[src="'+r+'"]');if(l.length)n=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img.active");var o=a.find('input[name="mb2_pb_editor_image_width"]'),m=a.find('input[name="mb2_pb_editor_image_desc"]'),c=a.find('select[name="mb2_pb_editor_image_align"]');i.val()&&n.attr("src",i.val()),o.val()&&n.attr("width",o.val()),m.val()&&n.attr("alt",m.val()),c.val()&&n.attr("class",c.val()),e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img").removeClass("active"),e(this).closest(".mb2-pb-editor-helper").find(".mb2-pb-preview-image").hide(),e(".mb2-pb-editor-helper-element").find("input").val(""),e(".mb2-pb-editor-helper-element").find("select").val("img-align-none");var d=e(".mb2-pb-element-active");0==d.length&&(d=e(".mb2-pb-subelement-active")),local_mb2builder_action_editor_html(e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-input"),d,!1,!1)}}),e(document).on("click",".mb2-pb-editor-document a",function(){e(".mb2-pb-editor-document").find("a").removeClass("active"),e(this).addClass("active")}),e(document).on("click",".mb2-pb-editor-document img",function(){e(".mb2-pb-editor-document").find("img").removeClass("active");var t=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-helper"),a=e(this),i=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-helper-element"),r=i.find(".mb2-pb-preview-image");r.show(),r.attr("src",a.attr("src"));var l=i.find('input[name="mb2_pb_input_image_url"]'),n=i.find('input[name="mb2_pb_editor_image_width"]'),o=i.find('input[name="mb2_pb_editor_image_desc"]'),m=i.find('select[name="mb2_pb_editor_image_align"]');l.val(a.attr("src")),n.val(a.attr("width")),o.val(a.attr("alt")),m.val(a.attr("class")),e(this).addClass("active"),t.find(".element-image").slideDown(250)}),e(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-image-cancel",function(t){t.preventDefault(),e(".mb2-pb-editor-helper-element").find("input").val(""),e(".mb2-pb-editor-helper-element").find("select").val("img-align-none"),e(this).closest(".mb2-pb-editor-helper").find(".mb2-pb-preview-image").hide(),e(this).closest(".mb2-pb-editor-helper").find(".element-image").slideUp(250),e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img").removeClass("active")}),e(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-link-cancel",function(t){t.preventDefault(),e(this).closest(".mb2-pb-editor-helper-element").slideUp(250),local_mb2builder_helper_editor_link_after_save()}),e(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-helper-image",function(t){var a=e(this).closest(".mb2-pb-active-editor").find(".mb2-pb-editor-helper");a.find(".element-link").hide(),a.find(".element-image").slideToggle(250)}),e(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-helper-link",function(t){var a=e(this).closest(".mb2-pb-active-editor").find(".mb2-pb-editor-helper");a.find(".element-image").hide(),a.find(".element-link").slideToggle(250),current_selection=window.getSelection(),current_selection_range=current_selection.getRangeAt(0);var i=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("a.active");i.length&&(a.find('input[name="mb2_pb_input_link_url"]').val(i.attr("href")),"_blank"===i.attr("target")&&(a.find('input[name="mb2_pb_editor_link_target"]').checked=!0))}),e(document).on("click",".mb2-pb-image-select",function(t){t.preventDefault(),e('input[name="mb2_pb_input_image_url"]').removeClass("mb2_pb_input_image_url_active"),e(this).closest(".mb2-pb-form-group").find('input[name="mb2_pb_input_image_url"]').addClass("mb2_pb_input_image_url_active"),e(".mb2-pb-search-image").val(""),e(".mb2-pb-search-image").trigger("keyup")}),e(document).on("click",".mb2-pb-upload-images",function(t){t.preventDefault(),e("#mb2-pb-images-iframe").contents().find("body").addClass("mb2-pb-iframe-content")}),e(document).on("click","#applay-file-manager",function(t){t.preventDefault(),window.onbeforeunload=null;var a=e(this).closest("#mb2-pb-modal-file-manager").find('[data-fieldtype="filepicker"]'),i=(e("#mb2-pb-modal-images").find(".mb2-pb-images"),e("#mb2-pb-modal-images").find(".mb2-pb-overlay")),r=e(this).closest("#mb2-pb-modal-file-manager").find("form"),l=e(this).closest("#mb2-pb-modal-file-manager").find(".mb2-pb-uploadmedia-wrap").attr("data-url");if(!a.find(".filepicker-filename>a").length)return null;i.fadeIn(180),e(this).closest(".modal-footer").find('[data-dismiss="modal"]').trigger("click"),a.find(".filepicker-filename").empty(),e.ajax({type:"POST",url:l,dataType:"html",data:r.serialize(),beforeSend:function(){},error:function(e,t,a){},success:function(t){e("#mb2-pb-modal-images").find(".mb2-pb-images").html(t),e(".mb2-pb-search-image").val(""),e(".mb2-pb-search-image").trigger("keyup"),setTimeout(function(){i.fadeOut(250)},450)}})}),e(document).on("click",".imgremove",function(t){t.preventDefault();var a=e("#mb2-pb-modal-images").find(".mb2-pb-overlay"),i=e(this).closest(".mb2-pb-images"),r=i.attr("data-url")+"?imgname="+e(this).attr("data-imgname")+"&sesskey="+e(".mb2-pb-settings").attr("data-sesskey");a.fadeIn(180),e.ajax({url:r,type:"get",dataType:"html",beforeSend:function(){},error:function(e,t,a){},success:function(t){i.html(t),e(".mb2-pb-search-image").val(""),e(".mb2-pb-search-image").trigger("keyup"),setTimeout(function(){a.fadeOut(250)},450)}})}),e(document).on("click",".mb2-pb-insert-image",function(t){t.preventDefault();var a=e(this).data("imgurl"),i=e(".mb2_pb_input_image_url_active");i.val(a),e(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").removeClass("isvideo"),local_mb2builder_check_image(a)||e(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").addClass("isvideo");var r=e(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").find(".mb2-pb-preview-image");r.show(),r.attr("src",a),e(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").find(".mb2-pb-desc-image").text(local_mb2builder_get_media_name(a));var l=i.closest(".mb2-pb-modal").data("type");local_mb2builder_image_action(a,i,l)}),e(document).on("click",".mb2-pb-remove-image",function(t){t.preventDefault(),e(this).closest(".mb2-pb-form-group").removeClass("isvideo");var a=e(this).closest(".mb2-pb-form-group").find('input[name="mb2_pb_input_image_url"]');a.val("");var i=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-preview-image");i.hide(),i.attr("src",""),e(this).closest(".mb2-pb-form-group").find(".mb2-pb-desc-image").empty();var r=a.closest(".mb2-pb-modal").data("type");local_mb2builder_image_remove_action(a,r)}),e(document).on("click",".mb2-pb-select-icon",function(t){t.preventDefault(),e(".mb2-pb-input-type-icon").removeClass("active"),e(this).closest(".mb2-pb-form-group").find(".mb2-pb-input-type-icon").addClass("active")}),e(document).on("click",".mb2-pb-choose-icon",function(t){t.preventDefault();var a=e(this).data("iconname"),i=e(".mb2-pb-input-type-icon.active"),r=i.closest(".mb2-pb-modal").data("type");i.val(a),e(".mb2-pb-input-type-icon.active").closest(".mb2-pb-form-group").find("i").show(),e(".mb2-pb-input-type-icon.active").closest(".mb2-pb-form-group").find("i").attr("class",a),e(".mb2-pb-search-icon").val(""),e(".mb2-pb-search-icon").trigger("keyup"),local_mb2builder_icon_action(a,i,r)}),e(document).on("click",".mb2-pb-remove-icon",function(t){t.preventDefault();var a=e(this).closest(".mb2-pb-form-group").find(".mb2-pb-input-type-icon");a.attr("data-default")?(a.val(a.attr("data-default")),e(this).closest(".mb2-pb-form-group").find("i").attr("class",a.attr("data-default"))):(a.val(""),e(this).closest(".mb2-pb-form-group").find("i").attr("class",""),e(this).closest(".mb2-pb-form-group").find("i").hide());var i=a.closest(".mb2-pb-modal").data("type");local_mb2builder_icon_remove_action(a,i)}),e(document).on("click",".prevent-click",function(e){e.preventDefault()}),e(".mb2-pb-modal").draggable({cursor:"move",handle:".modal-header",containment:"#mb2-pb-demo-iframe",scroll:!1}),e(".mb2-pb-search-icon").each(function(){e(this).on("keyup",function(){var t=e(this).val().toLowerCase();e(this).closest(".tab-pane").find(".mb2-pb-choose-icon").each(function(){e(this).filter('[data-iconname*="'+t+'"]').length>0||0==t.length?e(this).show():e(this).hide()})})}),e(".mb2-pb-search-image").each(function(){e(this).on("keyup",function(){var t=e(this).val();e(this).closest(".modal-body").find(".mb2-pb-insert-image").each(function(){e(this).filter('[data-imgname*="'+t+'"]').length>0||0==t.length?e(this).closest(".mb2-pb-image-toinsert").show():e(this).closest(".mb2-pb-image-toinsert").hide()})})}),e(".mb2-pb-import-select select").each(function(){e(this).on("change",function(){var t=e(this).val();e(this).closest(".tab-pane").find(".block-item").each(function(){""===t||t===e(this).attr("data-category")?e(this).show():e(this).hide()})})}),e(document).on("click",".mb2-pb-reslink",function(){var t=e("#mb2-pb-demo-iframe");t.removeClass("device-desktop device-tablet device-smartphone"),t.addClass("device-"+e(this).attr("data-device"))})}),function(e){e(window).on("load",function(){e(".loading-scr");setTimeout(function(){e(".mb2-pb-overlay.main-overlay").fadeOut(180)},450)})}(jQuery);
